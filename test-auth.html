<!DOCTYPE html>
<html>
<head>
    <title>Auth Test</title>
</head>
<body>
    <h1>Authentication Test</h1>
    <button onclick="testAuth()">Test Authentication</button>
    <div id="results"></div>

    <script>
        function log(message) {
            const results = document.getElementById('results');
            results.innerHTML += `<p>${message}</p>`;
            console.log(message);
        }

        async function testAuth() {
            const dbName = 'nutricare_users';
            document.getElementById('results').innerHTML = '';

            // Clear any existing test users
            localStorage.removeItem(dbName);
            log('Testing user database functionality...');

            // Test creating a user
            try {
                log('1. Testing user creation...');
                
                // Simulate the createUser function
                const users = localStorage.getItem(dbName) ? JSON.parse(localStorage.getItem(dbName)) : {};
                const email = 'test@example.com';
                
                // Check if user already exists
                if (users[email]) {
                    throw new Error('User with this email already exists');
                }
                
                // Create user object
                const newUser = {
                    id: `user_${Date.now()}`,
                    name: 'Test User',
                    email: email,
                    password: 'Password123!',
                    authType: 'email',
                    createdAt: new Date().toISOString(),
                    preferences: {
                        dietaryRestrictions: [],
                        allergies: [],
                        healthGoals: [],
                        preferredUnits: 'metric'
                    }
                };
                
                // Save to database
                users[email] = newUser;
                localStorage.setItem(dbName, JSON.stringify(users));
                
                log('   User creation successful: ' + JSON.stringify(newUser));
            } catch (error) {
                log('   User creation failed: ' + error.message);
            }

            // Test finding a user
            try {
                log('2. Testing user lookup...');
                
                // Simulate the findUserByEmail function
                const users = localStorage.getItem(dbName) ? JSON.parse(localStorage.getItem(dbName)) : {};
                const email = 'test@example.com';
                const user = users[email] || null;
                
                if (user) {
                    log('   User lookup successful: ' + JSON.stringify(user));
                } else {
                    log('   User not found');
                }
            } catch (error) {
                log('   User lookup failed: ' + error.message);
            }

            // Test validating password
            try {
                log('3. Testing password validation...');
                
                // Simulate the validatePassword function
                const users = localStorage.getItem(dbName) ? JSON.parse(localStorage.getItem(dbName)) : {};
                const email = 'test@example.com';
                
                if (!users[email]) {
                    log('   User not found');
                } else {
                    const isValid = users[email].password === 'Password123!';
                    log('   Password validation result: ' + isValid);
                }
            } catch (error) {
                log('   Password validation failed: ' + error.message);
            }

            log('User database tests completed.');
        }
    </script>
</body>
</html>